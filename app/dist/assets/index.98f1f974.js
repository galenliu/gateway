var e=Object.assign;import{m as t,u as n,a as s,C as r,A as a,c as o,T as i,I as l,M as c,b as d,B as h,d as u,e as m,f as p,g,h as f,i as E,N as w,j as y,k as v,l as b,E as S,P as C,S as k,n as T,o as x,p as N,q as I,F as M,r as J,s as O,t as L,v as P,D as j,w as U,x as A,y as R,z,G as D,H as $,J as B,K as H,L as F,O as W,Q as _,R as V,U as G,V as Q,W as q,X as K,Y as Z,Z as X,_ as Y,$ as ee,a0 as te,a1 as ne,a2 as se,a3 as re,a4 as ae,a5 as oe,a6 as ie,a7 as le,a8 as ce,a9 as de,aa as he,ab as ue,ac as me,ad as pe,ae as ge,af as fe,ag as Ee,ah as we,ai as ye,aj as ve,ak as be}from"./vendor.0fb01243.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const s=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,a)=>{const o=new URL(e,s);if(self[t].moduleMap[o])return n(self[t].moduleMap[o]);const i=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(i),onerror(){a(new Error(`Failed to import: ${e}`)),r(l)},onload(){n(self[t].moduleMap[o]),r(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/assets/");const Se="Alarm",Ce="AirQualitySensor",ke="BarometricPressureSensor",Te="BinarySensor",xe="Camera",Ne="ColorControl",Ie="ColorSensor",Me="DoorSensor",Je="EnergyMonitor",Oe="HumiditySensor",Le="LeakSensor",Pe="Light",je="Lock",Ue="MotionSensor",Ae="MultiLevelSensor",Re="MultiLevelSwitch",ze="OnOffSwitch",De="PushButton",$e="SmartPlug",Be="SmokeSensor",He="TemperatureSensor",Fe="Thermostat",We="VideoCamera",_e="connected",Ve="deleteThing",Ge="deleteThings",Qe="eventOccurred",qe="propertyStatus",Ke="refreshThings",Ze="OnOffProperty",Xe="adapter",Ye="notifier",et="extension",tt="room",nt=t((e=>({root:{display:"flex"},grow:{flexGrow:1},appBar:{width:{drawerWidth:200},transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:"calc(100% - 200px)",marginLeft:200,transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},menuButton:{marginRight:e.spacing(2)},title:{display:"none",[e.breakpoints.up("sm")]:{display:"block"}},hide:{display:"none"},inputRoot:{color:"inherit"},inputInput:{padding:e.spacing(1,1,1,0),paddingLeft:`calc(1em + ${e.spacing(4)}px)`,transition:e.transitions.create("width"),width:"100%",[e.breakpoints.up("md")]:{width:"20ch"}},sectionDesktop:{display:"none",[e.breakpoints.up("md")]:{display:"flex"}},sectionMobile:{display:"flex",[e.breakpoints.up("md")]:{display:"none"}}})));function st(e){const t=nt(),{t:v,i18n:b}=n();s();const{drawerOpen:S,setDrawerOpen:C,newThingsOpen:k,setNewThingsOpen:T}=r.useContext(Xt),[x,N]=r.useState(null),[I,M]=r.useState(null),J=Boolean(x),O=Boolean(I),L=()=>{M(null)},P=()=>{N(null),L()},j=r.createElement(g,{anchorEl:x,anchorOrigin:{vertical:"top",horizontal:"right"},id:"primary-search-account-menu",keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:J,onClose:P},r.createElement(f,{onClick:P},"Profile"),r.createElement(f,{onClick:P},"My account")),U="primary-search-account-menu-mobile",A=r.createElement(g,{anchorEl:I,anchorOrigin:{vertical:"top",horizontal:"right"},id:U,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:O,onClose:L},r.createElement(f,null,r.createElement(l,{"aria-label":"show 4 new mails",color:"inherit"},r.createElement(h,{badgeContent:4,color:"secondary"},r.createElement(E,null))),r.createElement("p",null,"Messages")),r.createElement(f,null,r.createElement(l,{"aria-label":"show 11 new notifications",color:"inherit"},r.createElement(h,{badgeContent:11,color:"secondary"},r.createElement(w,null))),r.createElement("p",null,"Notifications")),r.createElement(f,{onClick:e=>{N(e.currentTarget)}},r.createElement(l,{"aria-label":"account of current user","aria-controls":"primary-search-account-menu","aria-haspopup":"true",color:"inherit"},r.createElement(y,null)),r.createElement("p",null,"Profile")));return r.createElement(r.Fragment,null,r.createElement(a,{position:"fixed",className:o(t.appBar,{[t.appBarShift]:S})},r.createElement(i,null,r.createElement(l,{edge:"start",color:"inherit","aria-label":"open drawer",onClick:()=>C(!0),className:o(t.menuButton,S&&t.hide)},r.createElement(c,null)),r.createElement(d,{className:t.title,variant:"h6",noWrap:!0},e.title),r.createElement("div",{className:t.grow}),r.createElement("div",{className:t.sectionDesktop},e.add&&r.createElement(l,{"aria-label":"show 4 new mails",color:"inherit",onClick:()=>{e.show(!0)}},r.createElement(h,{badgeContent:0,color:"secondary"},r.createElement(u,{title:v("add things"),arrow:!0},r.createElement(m,null))))),r.createElement("div",{className:t.sectionMobile},r.createElement(l,{"aria-label":"show more","aria-controls":U,"aria-haspopup":"true",onClick:e=>{M(e.currentTarget)},color:"inherit"},r.createElement(p,null))))),A,j)}const rt={jwt:localStorage.getItem("jwt"),isLoggedIn(){return!!this.jwt},headers(e){const t={Accept:"application/json"};return this.jwt&&(t.Authorization=`Bearer ${this.jwt}`),e&&(t["Content-Type"]=e),t},getJson(e){const t={method:"GET",headers:this.headers()};return fetch(e,t).then((e=>{if(!e.ok)throw new Error(e.status);return e.json()}))},postJson(e,t){const n={method:"POST",headers:this.headers("application/json"),body:JSON.stringify(t)};return fetch(e,n).then((e=>{if(!e.ok)throw new Error(e.status);if(204!==e.status)return e.json()}))},putJson(e,t){const n={method:"PUT",headers:this.headers("application/json"),body:JSON.stringify(t)};return fetch(e,n).then((e=>{if(!e.ok)throw new Error(e.status);return e.json()}))},patchJson(e,t){const n={method:"PATCH",headers:this.headers("application/json"),body:JSON.stringify(t)};return fetch(e,n).then((e=>{if(!e.ok)throw new Error(e.status);return e.json()}))},delete(e){const t={method:"DELETE",headers:this.headers()};return console.log("url:",e),fetch(e,t).then((e=>{if(!e.ok)throw new Error(e.status)}))},loadImage(e){const t={headers:{Authorization:`Bearer ${this.jwt}`},cache:"reload"};return fetch(e,t).then((e=>{if(!e.ok)throw new Error(e.status);return e.blob()}))},userCount(){return this.getJson("/users/count").then((e=>e.count)).catch((()=>{throw new Error("Failed to get user count.")}))},assertJWT(){if(!this.jwt)throw new Error("No JWT go login..")},verifyJWT(){return fetch("/things",{headers:this.headers()}).then((e=>e.ok))},createUser(e,t,n){return this.postJson("/users",{name:e,email:t,password:n}).then((e=>{const t=e.jwt;localStorage.setItem("jwt",t),rt.jwt=t})).catch((()=>{throw new Error("Repeating signup not permitted")}))},getUser(e){return this.getJson(`/users/${encodeURIComponent(e)}`)},addUser(e,t,n){return this.postJson("/users",{name:e,email:t,password:n})},editUser(e,t,n,s,r){return this.putJson(`/users/${encodeURIComponent(e)}`,{id:e,name:t,email:n,password:s,newPassword:r})},userEnableMfa(e,t=null){const n={enable:!0};return t&&(n.mfa={totp:t}),this.postJson(`/users/${encodeURIComponent(e)}/mfa`,n)},userDisableMfa(e){return this.postJson(`/users/${encodeURIComponent(e)}/mfa`,{enable:!1})},userRegenerateMfaBackupCodes(e){return this.putJson(`/users/${encodeURIComponent(e)}/mfa/codes`,{generate:!0})},deleteUser(e){return this.delete(`/users/${encodeURIComponent(e)}`)},getAllUserInfo(){return this.getJson("/users/info")},login(e,t,n){const s={email:e,password:t};n&&(s.mfa={totp:n});const r={method:"POST",headers:this.headers("application/json"),body:JSON.stringify(s)};return fetch("/login",r).then((e=>{if(!e.ok){if(401===e.status)return e.text().then((e=>{throw new Error(e)}));throw new Error(e.status)}return e.json().then((e=>{const t=e.jwt;localStorage.setItem("jwt",t),this.jwt=t}))}))},logout(){return this.assertJWT(),localStorage.removeItem("jwt"),this.postJson("/log-out",{}).catch((()=>{console.error("Logout failed...")}))},getInstalledAddons(){return this.getJson("/addons")},getAddonConfig(e){return this.getJson(`/addons/${encodeURIComponent(e)}/config`)},setAddonConfig(e,t){return this.putJson(`/addons/${encodeURIComponent(e)}/config`,{config:t})},setAddonSetting(e,t){return this.putJson(`/addons/${encodeURIComponent(e)}`,{enabled:t})},installAddon(e,t,n){return this.postJson("/addons",{id:e,url:t,checksum:n})},uninstallAddon(e){return this.delete(`/addons/${encodeURIComponent(e)}`)},updateAddon(e,t,n){return this.patchJson(`/addons/${encodeURIComponent(e)}`,{url:t,checksum:n})},getAddonsInfo(){return this.getJson("/settings/addonsInfo")},getExperimentSetting(e){return this.getJson(`/settings/experiments/${encodeURIComponent(e)}`).then((e=>e.enabled)).catch((t=>{if("404"===t.message)return!1;throw new Error(`Error getting ${e}`)}))},setExperimentSetting(e,t){return this.putJson(`/settings/experiments/${encodeURIComponent(e)}`,{enabled:t})},getUpdateStatus(){return this.getJson("/updates/status")},getUpdateLatest(){return this.getJson("/updates/latest")},getSelfUpdateStatus(){return this.getJson("/updates/self-update")},setSelfUpdateStatus(e){return this.putJson("/updates/self-update",{enabled:e})},startUpdate(){return this.postJson("/updates/update",{})},getExtensions(){return this.getJson("/extensions")},getThings(){return this.getJson("/things")},getThing(e){return this.getJson(`/things/${encodeURIComponent(e)}`)},setThingLayoutIndex(e,t){return this.patchJson(`/things/${encodeURIComponent(e)}`,{layoutIndex:t})},setThingFloorplanPosition(e,t,n){return this.patchJson(`/things/${encodeURIComponent(e)}`,{floorplanX:t,floorplanY:n})},setThingCredentials(e,t){const n={thingId:e};return t.hasOwnProperty("pin")?n.pin=t.pin:(n.username=t.username,n.password=t.password),this.patchJson("/things",n)},addThing(e){return this.postJson("/things",e)},addWebThing(e){return this.postJson("/new_things",{url:e})},removeThing(e){return this.delete(`/things/${encodeURIComponent(e)}`)},updateThing(e,t){return this.putJson(`/things/${encodeURIComponent(e)}`,t)},getPushKey(){return this.getJson("/push/vapid-public-key")},pushSubscribe(e){return this.postJson("/push/register",e)},getNotifiers(){return this.getJson("/notifiers")},startPairing(e){return this.postJson("/actions",{pair:{input:{timeout:e}}})},cancelPairing(e){return this.delete(e)},getRules(){return this.getJson("/rules")},getRule(e){return this.getJson(`/rules/${encodeURIComponent(e)}`)},addRule(e){return this.postJson("/rules",e)},updateRule(e,t){return this.putJson(`/rules/${encodeURIComponent(e)}`,t)},deleteRule(e){return this.delete(`/rules/${encodeURIComponent(e)}`)},getLogs(){return this.getJson("/logs/.schema")},addLog(e){const t={method:"POST",headers:this.headers("application/json"),body:JSON.stringify(e)};let n;return fetch("/logs",t).then((e=>(n=e.ok,e.ok?e.json():e.text()))).then((e=>[n,e])).catch((()=>[n,null]))},deleteLog(e,t){return this.delete(`/logs/things/${encodeURIComponent(e)}/properties/${encodeURIComponent(t)}`)},uploadFloorplan(e){const t=new FormData;t.append("file",e);const n={method:"POST",headers:{Authorization:`Bearer ${this.jwt}`},body:t};return fetch("/uploads",n).then((e=>{if(!e.ok)throw new Error(e.status)}))},setupTunnel(e,t,n,s){const r={method:"POST",headers:this.headers("application/json"),body:JSON.stringify({email:e,subdomain:t,reclamationToken:n,optout:s})};return fetch("/settings/subscribe",r).then((e=>e.ok?e.json().then((e=>[!0,e])):[!1,e.statusText]))},skipTunnel(){const e={method:"POST",headers:this.headers("application/json"),body:JSON.stringify({})};return fetch("/settings/skiptunnel",e).then((e=>e.ok?e.json().then((e=>[!0,e])):[!1,e.statusText]))},reclaimDomain(e){return this.postJson("/settings/reclaim",{subdomain:e})},getLanSettings(){return this.getJson("/settings/network/lan")},getWlanSettings(){return this.getJson("/settings/network/wireless")},getDhcpSettings(){return this.getJson("/settings/network/dhcp")},getWirelessNetworks(){return this.getJson("/settings/network/wireless/networks")},getNetworkAddresses(){return this.getJson("/settings/network/addresses")},setLanSettings(e){return this.putJson("/settings/network/lan",e)},setWlanSettings(e){return this.putJson("/settings/network/wireless",e)},setDhcpSettings(e){return this.putJson("/settings/network/dhcp",e)},getNtpStatus(){return this.getJson("/settings/system/ntp")},restartNtpSync(){return this.postJson("/settings/system/ntp",{})},getSshStatus(){return this.getJson("/settings/system/ssh")},setSshStatus(e){return this.putJson("/settings/system/ssh",{enabled:e})},getPlatform(){return this.getJson("/settings/system/platform")},getTunnelInfo(){return this.getJson("/settings/tunnelinfo")},setDomainSettings(e){return this.putJson("/settings/domain",e)},getAdapters(){return this.getJson("/adapters")},getAuthorizations(){return this.getJson("/authorizations")},revokeAuthorization(e){return this.delete(`/authorizations/${encodeURIComponent(e)}`)},ping(){const e={method:"GET",headers:this.headers()};return fetch("/ping",e).then((e=>{if(!e.ok)throw new Error(e.status)}))},getCountry(){return this.getJson("/settings/localization/country")},setCountry(e){return this.putJson("/settings/localization/country",{country:e})},getTimezone(){return this.getJson("/settings/localization/timezone")},setTimezone(e){return this.putJson("/settings/localization/timezone",{zone:e})},getLanguage(){return this.getJson("/settings/localization/language")},setLanguage(e){return this.putJson("/settings/localization/language",{language:e})},getUnits(){return this.getJson("/settings/localization/units")},setUnits(e){return this.putJson("/settings/localization/units",e)}};window.API=rt;class at{constructor(){return this.handlers=new Map,this}cleanup(){this.handlers.forEach((e=>{e.clear()})),this.handlers.clear()}unsubscribe(e,t){if(!this.handlers.has(e))return;this.handlers.get(e).delete(t)}subscribe(e,t){this.handlers.has(e)||this.handlers.set(e,new Map);this.handlers.get(e).set(t,t)}async handleEvent(e,t){if(!this.handlers.has(e))return;const n=this.handlers.get(e);for(const r of n.keys())try{await r(t)}catch(s){console.error(`Error occurred in handler event:${e} state:${t} ${s}`)}}}class ot{constructor(e){this.href=e,this.ws=null,this.closing=!1,this.opening=!1,this.onOpen=this.onOpen.bind(this),this.onMessage=this.onMessage.bind(this),this.reopen=this.reopen.bind(this),this.closePermanently=this.closePermanently.bind(this),this.listeners={open:[],message:[]},this.open()}open(){this.closing||(this.opening=!0,this.ws=new WebSocket(this.href),window.addEventListener("beforeunload",this.closePermanently),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("close",this.reopen),this.ws.addEventListener("error",this.reopen))}addEventListener(e,t){if("open"!==e&&"message"!=e)throw new Error(`Event ${e} not supported`);"open"!==e||this.opening||t(),this.listeners[e].push(t)}onOpen(){this.backoff=1e3,this.opening=!1;for(const e of this.listeners.open)e()}onMessage(e){for(const t of this.listeners.message)t(e)}reopen(){this.ws.removeEventListener("open",this.onOpen),this.ws.removeEventListener("message",this.onMessage),this.ws.removeEventListener("close",this.reopen),this.ws.removeEventListener("error",this.reopen),this.ws.close(),this.ws=null,window.removeEventListener("beforeunload",this.closePermanently),setTimeout((()=>{this.backoff*=2,this.backoff>3e4&&(this.backoff=3e4),this.open()}),this.backoff)}send(e){return this.ws.send(e)}closePermanently(){this.closing=!0,this.listeners={},this.ws&&(this.ws.removeEventListener("open",this.onOpen),this.ws.removeEventListener("message",this.onMessage),this.ws.removeEventListener("close",this.reopen),this.ws.removeEventListener("error",this.reopen),this.ws.readyState!==WebSocket.OPEN&&this.ws.readyState!==WebSocket.CONNECTING||this.ws.close(),this.ws=null)}}class it extends at{constructor(e,t){return super(),this.properties={},this.events=[],this.connected=!1,this.updateFromDescription(e),this.initWebSocket(t),this.updateEvents(),this}updateFromDescription(e){this.title=e.title,this.id=decodeURIComponent(e.id.split("/").pop()),this.href=new URL(e.id,ct.ORIGIN);for(const t of e.forms)switch(t.rel){case"events":this.eventsHref=new URL(t.href,ct.ORIGIN);break;case"properties":this.propertiesHref=new URL(t.href,ct.ORIGIN)}if(this.propertyDescriptions={},e.hasOwnProperty("properties"))for(const t in e.properties){const n=e.properties[t];this.propertyDescriptions[t]=n}if(this.eventDescriptions={},e.hasOwnProperty("events"))for(const t in e.events){const n=e.events[t];this.eventDescriptions[t]=n}}removeThing(){return rt.removeThing(this.id).then((()=>{this.handleEvent(Ve,this.id).then(),this.cleanup()}))}updateThing(e){return rt.updateThing(this.id,e)}initWebSocket(e){if(!this.hasOwnProperty("href"))return;this.ws=e,this.ws.addEventListener("open",(()=>{if(0===Object.keys(this.eventDescriptions).length)return;const e={id:this.id,messageType:"addEventSubscription",data:{}};for(const t in this.eventDescriptions)e.data[t]={};this.ws.send(JSON.stringify(e))}));this.ws.addEventListener("message",(e=>{const t=JSON.parse(e.data);if(!t.hasOwnProperty("id")||t.id===this.id)switch(t.messageType){case"propertyStatus":this.onPropertyStatus(t.data).then((e=>{}));break;case"event":this.onEvent(t.data).then((e=>{}));break;case"connected":this.onConnected(t.data).then((e=>{}));break;case"error":"404 Not Found"===t.data.status&&(console.log("Successfully removed Thing."),this.handleEvent(Ve,this.id),this.cleanup());break;case"thingRemoved":this.handleEvent(Ve,this.id),this.cleanup()}}))}subscribe(e,t){switch(super.subscribe(e,t),e){case Qe:break;case qe:t(this.properties);break;case Ve:break;case _e:t(this.connected);break;default:console.warn(`ThingModel does not support event:${e}`)}}setProperty(e,t){if(!this.propertyDescriptions.hasOwnProperty(e))return Promise.reject(`Unavailable property name ${e}`);switch(this.propertyDescriptions[e].type){case"number":t=parseFloat(t);break;case"integer":t=parseInt(t);break;case"boolean":t=Boolean(t)}const n=this.propertyDescriptions[e];let s;for(const r of n.forms)if(!r.rel||"property"===r.rel){s=r.href;break}return rt.putJson(s,t).then((e=>{console.log("json",e),this.onPropertyStatus(e)})).catch((t=>{throw console.error(t),new Error(`Error trying to set ${e}`)}))}updateProperties(){let e;if(void 0===this.propertiesHref){const t=Object.values(this.propertyDescriptions).map((e=>{for(const t of e.forms)if(!t.rel||"property"===t.rel)return t.href})).map((e=>rt.getJson(e)));e=Promise.all(t).then((e=>{let t={};return e.forEach((e=>{t=Object.assign(t,e)})),t}))}else e=rt.getJson(this.propertiesHref);e.then((e=>{this.onPropertyStatus(e)})).catch((e=>{console.error(`Error fetching ${this.title} status: ${e}`)}))}onPropertyStatus(e){const t={};for(const n in e){if(!this.propertyDescriptions.hasOwnProperty(n))continue;const s=e[n];null!=s&&(this.properties[n]=s,t[n]=s)}return console.log("updatedProperties:",t),this.handleEvent(qe,t)}updateEvents(){if(void 0!==this.eventsHref)return rt.getJson(this.eventsHref).then((e=>{this.events=e})).catch((e=>{console.error(`Error fetching events: ${e}`)}))}onEvent(e){const t={};for(const n in e)this.eventDescriptions.hasOwnProperty(n)&&(t[n]=e[n],this.events.push({[n]:e[n]}));return this.handleEvent(Qe,t)}onConnected(e){return this.connected=e,e&&this.updateProperties(),this.handleEvent(_e,e)}}class lt extends at{constructor(){return super(),this.thingModels=new Map,this.things=new Map,this.connectedThings=new Map,this.onMessage=this.onMessage.bind(this),this.queue=Promise.resolve(!0),this.connectWebSocket(),this}addQueue(e){return this.queue=this.queue.then(e).catch((e=>{console.error(e)})),this.queue}subscribe(e,t,n=!1){switch(super.subscribe(e,t),e){case Ke:n&&t(this.things);break;case Ge:break;default:console.warn(`GatewayModel does not support event:${e}`)}}setThing(e,t){if(console.log("setThing thingId: \t\n",e," \t\n description:\t\n",t),this.thingModels.has(e)){this.thingModels.get(e).updateFromDescription(t)}else{const n=new it(t,this.ws);n.subscribe(Ve,this.handleRemove.bind(this)),this.connectedThings.has(e)&&n.onConnected(this.connectedThings.get(e)),this.thingModels.set(e,n)}this.things.set(e,t),console.log(" gateway things:\t\n",this.things,"\t\nmodels:\t\n",this.thingModels)}getThing(e){return this.thingModels.has(e)&&this.things.has(e)?Promise.resolve(this.things.get(e)):this.refreshThing(e).then((()=>this.things.get(e)))}getThingModel(e){return this.thingModels.has(e)?Promise.resolve(this.thingModels.get(e)):this.refreshThing(e).then((()=>this.thingModels.get(e)))}removeThing(e){return this.thingModels.has(e)?this.addQueue((()=>{if(!this.thingModels.has(e))throw new Error(`Thing id:${e} already removed`);return this.thingModels.get(e).removeThing()})):Promise.reject(`No Thing id:${e}`)}updateThing(e,t){return this.thingModels.has(e)?this.addQueue((()=>{if(!this.thingModels.has(e))throw new Error(`Thing id:${e} already removed`);return this.thingModels.get(e).updateThing(t).then((()=>{this.refreshThing(e)}))})):Promise.reject(`No Thing id:${e}`)}handleRemove(e,t=!1){if(this.thingModels.has(e)&&(this.thingModels.get(e).cleanup(),this.thingModels.delete(e)),this.things.has(e)&&this.things.delete(e),!t)return this.handleEvent(Ge,this.things)}connectWebSocket(){const e=`${window.location.origin}/things`.replace(/^http/,"ws");this.ws=new ot(e),this.ws.addEventListener("open",this.refreshThings.bind(this)),this.ws.addEventListener("message",this.onMessage)}onMessage(e){const t=JSON.parse(e.data);switch(t.messageType){case"connected":this.connectedThings.set(t.id,t.data);break;case"thingAdded":this.refreshThings().then((e=>{}));break;case"thingModified":this.refreshThing(t.id).then((e=>{}))}}refreshThings(){return this.addQueue((()=>rt.getThings().then((e=>{const t=new Set;e.forEach((e=>{const n=decodeURIComponent(e.id.split("/").pop());t.add(n),this.setThing(n,e)}));return Array.from(this.thingModels.keys()).filter((e=>!t.has(e))).forEach((e=>this.handleRemove(e,!0))),this.handleEvent(Ke,this.things)})).catch((e=>{console.error(`Get things failed ${e}`)}))))}refreshThing(e){return this.addQueue((()=>rt.getThing(e).then((t=>{if(!t)throw new Error(`Unavailable Thing Description: ${t}`);return this.setThing(e,t),this.handleEvent(Ke,this.things)})).catch((t=>{console.error(`Get thing id:${e} failed ${t}`)}))))}}const ct={ORIGIN:window.location.origin,HOST:window.location.host,LANGUAGE:"en-US",TIMEZONE:"UTC",UNITS:{},init:function(){this.gatewayModel=new lt},showThings:function(){ct.gatewayModel.refreshThings()}};function dt(t){return r.createElement("div",null,function(){switch(t.type){case Se:case Ce:case ke:return r.createElement(k,null,r.createElement("path",{id:"path33982",d:"m 25.846133,13.948735 c 0,-5.0051332 -2.707666,-9.2717999 -7.3846,-10.3384666 V 2.461535 C 18.461533,1.0666684 17.394867,1.725e-6 16,1.725e-6 14.605133,1.725e-6 13.538467,1.0666684 13.538467,2.461535 V 3.6102684 C 8.8615329,4.7590018 6.1537999,8.9436018 6.1537999,13.948735 v 8.205134 l -3.282,3.282 v 1.641066 H 29.1282 v -1.641066 l -3.282067,-3.282 z M 16,32.000002 c 0.246133,0 0.410267,0 0.6564,-0.08207 1.066667,-0.246133 1.9692,-0.9846 2.379467,-1.9692 C 19.2,29.538466 19.282,29.128199 19.282,28.635932 h -6.564067 c 0,1.887134 1.476934,3.364067 3.282067,3.364067 z",className:"st1",style:"fill:#ffffff;stroke-width:0.66666669"}));case Te:return r.createElement(k,null,r.createElement("path",{style:"fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#ffffff;stroke-width:4;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1",d:"m 3549.5381,16711.819 5.3245,5.568 12.706,-15.594",id:"path16328"}));case xe:return r.createElement(k,null,r.createElement("path",{d:"m 20.87395,17.969002 a 4.875,4.875 0 0 1 -4.8749,4.875 4.875,4.875 0 0 1 -4.875,-4.875 4.875,4.875 0 0 1 4.875,-4.876 4.875,4.875 0 0 1 4.8749,4.876 z M 8.8730498,4.0320016 c -1.315,0 -2.375,1.058 -2.375,2.3730001 v 1.5629999 h -2.498 c -2.216,0 -4.000000033453,1.784 -4.000000033453,4.0000004 v 12 c 0,2.216 1.784000033453,4 4.000000033453,4 H 27.99995 c 2.216,0 4,-1.784 4,-4 v -12 c 0,-2.2160004 -1.784,-4.0000004 -4,-4.0000004 h -2.502 V 6.4050017 c 0,-1.3150001 -1.057,-2.3730001 -2.373,-2.3730001 z m 19.0569002,5.435 a 2.6652915,2.6652915 0 0 1 2.666,2.6660004 2.6652915,2.6652915 0 0 1 -2.666,2.664 2.6652915,2.6652915 0 0 1 -2.665,-2.664 2.6652915,2.6652915 0 0 1 2.665,-2.6660004 z m -11.9299,1.7510004 a 6.7500001,6.7500001 0 0 1 6.7479,6.75 6.7500001,6.7500001 0 0 1 -6.7479,6.751 6.7500001,6.7500001 0 0 1 -6.7500002,-6.751 6.7500001,6.7500001 0 0 1 6.7500002,-6.75 z",style:"opacity:1;fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:3.72794151;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:8.80000019;stroke-dasharray:29.82352957, 14.91176477;stroke-dashoffset:0;stroke-opacity:1;paint-order:fill markers stroke",id:"circle28864-8"}));case Ne:case Ie:case Me:case Je:case Oe:case Le:return r.createElement(k,null,r.createElement("path",{id:"path33982",d:"m 25.846133,13.948735 c 0,-5.0051332 -2.707666,-9.2717999 -7.3846,-10.3384666 V 2.461535 C 18.461533,1.0666684 17.394867,1.725e-6 16,1.725e-6 14.605133,1.725e-6 13.538467,1.0666684 13.538467,2.461535 V 3.6102684 C 8.8615329,4.7590018 6.1537999,8.9436018 6.1537999,13.948735 v 8.205134 l -3.282,3.282 v 1.641066 H 29.1282 v -1.641066 l -3.282067,-3.282 z M 16,32.000002 c 0.246133,0 0.410267,0 0.6564,-0.08207 1.066667,-0.246133 1.9692,-0.9846 2.379467,-1.9692 C 19.2,29.538466 19.282,29.128199 19.282,28.635932 h -6.564067 c 0,1.887134 1.476934,3.364067 3.282067,3.364067 z",className:"st1",style:"fill:#ffffff;stroke-width:0.66666669"}));case Pe:return console.log("props.type:",t.type),r.createElement(v,e(e({},t),{path:T,horizontal:!0,vertical:!0,rotate:180}));case je:case Ue:case Ae:case Re:return r.createElement(k,null,r.createElement("path",{id:"path33982",d:"m 25.846133,13.948735 c 0,-5.0051332 -2.707666,-9.2717999 -7.3846,-10.3384666 V 2.461535 C 18.461533,1.0666684 17.394867,1.725e-6 16,1.725e-6 14.605133,1.725e-6 13.538467,1.0666684 13.538467,2.461535 V 3.6102684 C 8.8615329,4.7590018 6.1537999,8.9436018 6.1537999,13.948735 v 8.205134 l -3.282,3.282 v 1.641066 H 29.1282 v -1.641066 l -3.282067,-3.282 z M 16,32.000002 c 0.246133,0 0.410267,0 0.6564,-0.08207 1.066667,-0.246133 1.9692,-0.9846 2.379467,-1.9692 C 19.2,29.538466 19.282,29.128199 19.282,28.635932 h -6.564067 c 0,1.887134 1.476934,3.364067 3.282067,3.364067 z",className:"st1",style:"fill:#ffffff;stroke-width:0.66666669"}));case ze:return r.createElement(k,e({},t),r.createElement("path",{fill:"currentColor",d:"M13,3H11V13H13V3M17.83,5.17L16.41,6.59C18.05,7.91 19,9.9 19,12A7,7 0 0,1 12,19C8.14,19 5,15.88 5,12C5,9.91 5.95,7.91 7.58,6.58L6.17,5.17C2.38,8.39 1.92,14.07 5.14,17.86C8.36,21.64 14.04,22.1 17.83,18.88C19.85,17.17 21,14.65 21,12C21,9.37 19.84,6.87 17.83,5.17Z"}));case De:case $e:case Be:case He:case Fe:case We:return r.createElement(k,null,r.createElement("path",{id:"path33982",d:"m 25.846133,13.948735 c 0,-5.0051332 -2.707666,-9.2717999 -7.3846,-10.3384666 V 2.461535 C 18.461533,1.0666684 17.394867,1.725e-6 16,1.725e-6 14.605133,1.725e-6 13.538467,1.0666684 13.538467,2.461535 V 3.6102684 C 8.8615329,4.7590018 6.1537999,8.9436018 6.1537999,13.948735 v 8.205134 l -3.282,3.282 v 1.641066 H 29.1282 v -1.641066 l -3.282067,-3.282 z M 16,32.000002 c 0.246133,0 0.410267,0 0.6564,-0.08207 1.066667,-0.246133 1.9692,-0.9846 2.379467,-1.9692 C 19.2,29.538466 19.282,29.128199 19.282,28.635932 h -6.564067 c 0,1.887134 1.476934,3.364067 3.282067,3.364067 z",className:"st1",style:"fill:#ffffff;stroke-width:0.66666669"}));case Xe:return r.createElement(C,e({},t));case et:return r.createElement(S,e({},t));case Ye:return r.createElement(w,e({},t));case tt:return r.createElement(v,e(e({},t),{path:b,size:1,horizontal:!0,vertical:!0,rotate:90}))}}())}function ht(t){switch(t.type){case Pe:return r.createElement(v,e(e({},t),{path:x,size:1,horizontal:!0,vertical:!0,rotate:180}))}}const ut=t((e=>({newThingCard:{display:"flex",maxWidth:360,minWidth:360,margin:10,alignItems:"center",justifyContent:"space-between"},formControl:{margin:e.spacing(1),minWidth:120},button:{margin:e.spacing(1),minHigh:50},icon:{},content:{padding:12,display:"flex",flexDirection:"column"}}))),mt="save",pt="processing",gt="saved",ft="fail";function Et(t){const{t:s,i18n:a}=n(),o=ut(),[i,l]=r.useState(e(e({},t.thing),{selectedCapability:t.thing["@type"][0]})),[c,h]=r.useState(mt);const u=t=>{h(pt),rt.addThing(i).then((t=>{if(t.id!==i.id)throw new Error("fail");t.connected&&(l(e(e({},i),{connected:!0})),h(gt))})).catch(h(ft))};return r.createElement(r.Fragment,null,r.createElement(N,{className:o.newThingCard,elevation:5},r.createElement(dt,{className:o.icon,style:{fontSize:80},color:"primary",type:i.selectedCapability}),r.createElement("div",{className:o.content},r.createElement(I,{disabled:c===gt||c===ft,id:"standard-basic",label:s("Title"),defaultValue:i.title,onChange:t=>{let n=i;n.title=t.target.value,console.log("event.target.value",t.target.value),l(e({},n))}}),r.createElement(M,{className:o.formControl},r.createElement(J,null,s("SelectedCapability")),r.createElement(O,{disabled:c===gt||c===ft,onChange:t=>{let n=i;n.selectedCapability=t.target.value,l(e({},n))},labelId:"demo-simple-select-label",id:"demo-simple-select",value:i.selectedCapability},function(){let e=[];for(const n of t.thing["@type"])e.push(r.createElement(f,{value:n,key:n},s(n)));return e}()))),c===mt&&r.createElement(L,{variant:"contained",color:"primary",className:o.button,onClick:u},s(c)),c===pt&&r.createElement(P,null),i.connected&&r.createElement(L,{color:"primary",disabled:!0,className:o.button,onClick:u},s(gt)),c===ft&&r.createElement(L,{color:"secondary",disabled:!0,className:o.button,onClick:u},r.createElement(d,{gutterBottom:!0,color:"secondary"},s(ft)))),r.createElement(j,null))}const wt=t((t=>({appBar:{},title:{marginLeft:t.spacing(2),flex:1},drawerHeader:e(e({display:"flex",alignItems:"center",padding:t.spacing(0,1)},t.mixins.toolbar),{justifyContent:"flex-end"})}))),yt=r.forwardRef((function(t,n){return r.createElement(U,e({direction:"up",ref:n},t))}));function vt(t){const s=wt(),{t:o,i18n:c}=n(),h=r.useRef(null);r.useContext(Xt);const[u,m]=r.useState({}),[p,g]=r.useState(),[f,E]=r.useState(""),[w,y]=r.useState("正在链接中"),v=r.useCallback((()=>{const e=["正在链接中","正在扫描新设备","连接正在关闭","扫描完成"];console.log("start requestPairing......");let t="ws://";"https:"===window.location.protocol&&(t="wss://");const n=t+window.location.host+"/new_things";h.current=new WebSocket(n),h.current.onopen=t=>{var n,s;return y(e[null!=(s=null==(n=h.current)?void 0:n.readyState)?s:0])},h.current.onclose=t=>{var n,s;return y(e[null!=(s=null==(n=h.current)?void 0:n.readyState)?s:0])},h.current.onerror=t=>{var n,s;return y(e[null!=(s=null==(n=h.current)?void 0:n.readyState)?s:0])},h.current.onmessage=e=>{console.log(e),E(e.data)}}),[h]);function b(){var e;console.log("cancel pairing...."),null==(e=h.current)||e.close(),void 0!==p&&rt.cancelPairing(p).catch((e=>{console.log("cancelParing err:",e)}))}return r.useEffect((()=>{try{if(f){let t=JSON.parse(f);const n=u;u.hasOwnProperty(t.id)||(n[t.id]=t,m(e({},n)),console.log("AvailableThings update :",u))}}catch(t){b(),console.log("message err:",t)}}),[f]),r.useEffect((()=>{t.open&&(console.log("...................."),m([]),v(),rt.startPairing(5e3).then((e=>{g(e.href),setTimeout((()=>{b()}),5e3)})).catch((e=>{console.log("startPairing err:",e)}))),t.open}),[t.open]),r.createElement("div",null,r.createElement(A,{fullScreen:!0,open:t.open,onClose:()=>t.show(!0),TransitionComponent:yt},r.createElement(a,{className:s.appBar},r.createElement(i,null,r.createElement(d,{variant:"h6",className:s.title},o(w),"......"),r.createElement(l,{autoFocus:!0,color:"inherit",onClick:()=>{t.show(!1),b()},"aria-label":"close"},r.createElement(R,null)))),r.createElement("div",{className:s.drawerHeader}),r.createElement(z,{container:!0,justify:"flex-start",alignItems:"center",direction:"column"},function(){let e=[];for(let t in u){let n=u[t];console.log("render thing :",n);const s=r.createElement(Et,{key:n.id,thing:n});e.push(s)}return e}())))}const bt=t((e=>({thingCard:{borderRadius:12,display:"flex",minWidth:160,maxWidth:160,justifyContent:"space-between",flexDirection:"column"},modal:{display:"flex",alignItems:"center",justifyContent:"center"},cardTop:{display:"flex",flexDirection:"row",marginTop:5,marginRight:5,alignItems:"flex-start",justifyContent:"space-between"},cardBot:{display:"flex",marginLeft:4,flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between"},root:{display:"flex",alignItems:"center",justifyContent:"center"}}))),St="disconnect",Ct="updating";function kt(t){const s=bt(),{t:a,i18n:o}=n();r.useState(!1);const[i,l]=r.useState(ct.gatewayModel.things.get(t.thingId)),[c,h]=r.useState();return r.useEffect((()=>{function e(e){}let n=ct.gatewayModel.thingModels.get(t.thingId);return n.subscribe(qe,e),h(Ct),()=>{n.unsubscribe(qe,e)}}),[]),r.createElement(r.Fragment,null,r.createElement(z,{item:!0,className:s.root},r.createElement(N,{elevation:10,className:s.thingCard,onClick:()=>t.open(t.thingId)},r.createElement("div",{className:s.cardTop},r.createElement(dt,{state:c,color:"#fb8c00",type:i.selectedCapability,size:2}),r.createElement(ht,{cursor:"pointer",state:c,type:i.selectedCapability,size:2,onClick:function(e){if(e.stopPropagation(),i.selectedCapability===Pe)for(const t in model.propertyDescriptions){let e=model.propertyDescriptions[t];if(e["@type"]===Ze){let t,n=e.value;switch(e.type){case"number":n=parseFloat(n);break;case"integer":n=parseInt(n);break;case"boolean":n=Boolean(n),t=!n}console.log("toggle:",t)}}}})),r.createElement("div",{className:s.cardBot},r.createElement(d,{variant:"body1"},i.title),r.createElement(d,e(e({},c===Ct?{color:"primary",variant:"body2"}:c===St?"secondary":{color:"primary",variant:"h6"}),{t:2}),a(c))))))}const Tt=t((t=>({margin:{margin:t.spacing(1)},list:{display:"flex",width:"100%",flexDirection:"column",backgroundColor:t.palette.background.paper},content:{flexDirection:"column",display:"flex",alignItems:"center",justifyContent:"center",flexGrow:1,padding:t.spacing(3),transition:t.transitions.create("margin",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},drawerHeader:e(e({display:"flex",alignItems:"center",padding:t.spacing(0,1)},t.mixins.toolbar),{justifyContent:"flex-end"}),appBar:{position:"relative"},title:{marginLeft:t.spacing(2),flex:1},listItem:{marginTop:5,marginBottom:5,maxWidth:400,minWidth:300},root:{display:"flex",alignItems:"center",justifyContent:"center"}}))),xt=r.forwardRef((function(t,n){return r.createElement(U,e({direction:"up",ref:n},t))}));function Nt(e){const{t:t,i18n:s}=n(),[o,c]=r.useState(ct.gatewayModel.things.get(e.thingId)),[h,u]=r.useState(o.properties),[m,p]=r.useState(!1),g=Tt(),f=r.useCallback((()=>{e.show(!1)}));return r.useEffect((()=>{console.log("properties:",h);const t=t=>{t.get(e.thingId)||p(!0)},n=()=>{c(ct.gatewayModel.things.get(e.thingId))};return ct.gatewayModel.thingModels.get(e.thingId).subscribe(Ve,t),ct.gatewayModel.thingModels.get(e.thingId).subscribe(Ke,n),()=>{ct.gatewayModel.thingModels.get(e.thingId).unsubscribe(Ve,t),ct.gatewayModel.thingModels.get(e.thingId).unsubscribe(Ke,n)}})),r.useEffect((()=>{u(o.properties)}),[o]),r.createElement(r.Fragment,null,r.createElement(A,{open:m,onClose:()=>p(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.createElement(D,{id:"alert-dialog-title"},t("accessories removed")),r.createElement($,null,r.createElement(B,{id:"alert-dialog-description"},t("accessories removed"))),r.createElement(H,null,r.createElement(L,{onClick:()=>{p(!1)},color:"primary",autoFocus:!0},t("Ok")))),!m&&r.createElement(A,{fullScreen:!0,className:g.root,open:e.open,onClose:()=>e.show(!1),TransitionComponent:xt},r.createElement(a,{className:g.appBar},r.createElement(i,null,r.createElement(dt,{prop:!0,color:"#fb8c00",type:o.selectedCapability,size:2}),r.createElement(d,{variant:"h6",className:g.title},o.title),r.createElement(l,{autoFocus:!0,color:"inherit",onClick:()=>e.show(!1),"aria-label":"close"},r.createElement(R,null)))),r.createElement($,null,r.createElement("div",{className:g.drawerHeader}),r.createElement(z,{className:g.content,container:!0},r.createElement(Mt,{thing:o}),r.createElement(It,{thing:o,remove:f})))))}function It(e){const t=Tt(),{t:s,i18n:a}=n(),[o,i]=r.useState(e.thing.title);return r.createElement(r.Fragment,null,r.createElement(F,{subheader:r.createElement(W,null,"Settings"),className:t.list},r.createElement(j,null),r.createElement(_,{className:t.listItem,variant:"contained",elevation:90},void 0),r.createElement(_,{className:t.listItem,variant:"contained",elevation:90},r.createElement(V,null,r.createElement(dt,{prop:!0,color:"#fb8c00",type:e.thing.selectedCapability,size:1})),r.createElement(I,{defaultValue:e.thing.title,onChange:e=>i(e.target.value)}),o!==e.thing.title&&r.createElement(G,{cursor:"pointer"})),r.createElement(j,null),r.createElement(_,{button:!0,className:t.listItem,variant:"contained"},r.createElement(V,null,r.createElement(S,null)),r.createElement(Q,{primary:s("Addons")}),r.createElement(q,null)),r.createElement(j,null),r.createElement(_,{button:!0,className:t.listItem,variant:"contained",elevation:111},r.createElement(V,null,r.createElement(K,null)),r.createElement(M,{className:t.formControl,style:{width:"100%"}},r.createElement(Z,{id:"demo-simple-select-label"},s("Room")),r.createElement(O,{labelId:"demo-simple-select-label",id:"demo-simple-select"},r.createElement(f,{value:10},"客厅"),r.createElement(f,{value:20},"卧室"),r.createElement(f,{value:30},"厨房")))),r.createElement(j,null),r.createElement(_,null,r.createElement(Q,{id:"switch-list-label-wifi",primary:s("On")}),r.createElement(X,null,r.createElement(Y,{edge:"end",inputProps:{"aria-labelledby":"switch-list-label-wifi"}}))),r.createElement(j,null),r.createElement(_,{color:"red",button:!0,onClick:()=>e.remove()},r.createElement(L,{variant:"contained",color:"secondary",style:{width:"100%"}},s("remove the accessories"))),r.createElement(j,null)))}function Mt(e){return n(),r.createElement(r.Fragment,null)}const Jt=t((t=>({containerGrid:{alignItems:"flex-start",height:"200",minHeight:"200",flexGrow:1,padding:t.spacing(3),transition:t.transitions.create("margin",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),marginLeft:200},contentShift:{transition:t.transitions.create("margin",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen}),marginLeft:0},drawerHeader:e(e({display:"flex",alignItems:"center",padding:t.spacing(0,1)},t.mixins.toolbar),{justifyContent:"flex-end"})}))),Ot="pending",Lt="connected",Pt="disconnected";function jt(e){const t=Jt(),{drawerOpen:s}=r.useContext(Xt),[a,i]=r.useState(),[l,c]=r.useState(!1),[d,h]=r.useState(!1),[u,m]=r.useState(null),[p,g]=r.useState(Lt),{t:f,i18n:E}=n();function w(e){m(e)}return r.useEffect((()=>{const e=e=>{i(e)};return ct.gatewayModel.subscribe(Ke,e),ct.showThings(),()=>{ct.gatewayModel.unsubscribe(Ke,e)}}),[e]),r.useEffect((()=>{h(!0)}),[u]),r.createElement(r.Fragment,null,r.createElement(st,{add:!0,show:c,title:f("Things")}),r.createElement("div",{className:t.drawerHeader}),r.createElement(z,{style:{justifyContent:!p===Ot?"flex-start":"center"},className:o(t.containerGrid,{[t.contentShift]:!s}),container:!0,spacing:2},p===Ot&&r.createElement(P,{disableShrink:!0}),p===Lt&&function(){if(void 0===a)return;let e=[];for(const[t,n]of a){let s=r.createElement(kt,{key:t,thingId:t,description:n,open:w});e.push(s),console.log(s)}return e}(),p===Pt&&r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},r.createElement(ee,null),r.createElement("h4",null,f("disconnect")))),r.createElement(vt,{open:l,show:c}),null!==u&&d&&r.createElement(Nt,{open:d,show:h,thingId:u}),"}")}const Ut=t((t=>({root:{display:"flex"},grow:{flexGrow:1},drawer:{width:200,flexShrink:0},drawerPaper:{width:200},drawerHeader:e(e({display:"flex",alignItems:"center",padding:t.spacing(0,1)},t.mixins.toolbar),{justifyContent:"flex-end"})})));function At(e){let t=te();const a=Ut(),{drawerOpen:o,setDrawerOpen:i,newThingsOpen:c,setNewThingsOpen:d}=r.useContext(Xt);console.log("layout sidebar",o);const{t:h,i18n:u}=n(),m=s();function p(e){i(!1),t.push(e)}return r.createElement(r.Fragment,null,r.createElement(ne,{className:a.drawer,width:"240",variant:"persistent",anchor:"left",open:o,classes:{paper:a.drawerPaper}},r.createElement("div",{className:a.drawerHeader},r.createElement(l,{onClick:()=>i(!1)},"ltr"===m.direction?r.createElement(se,null):r.createElement(re,null))),r.createElement(j,null),r.createElement(F,null,r.createElement(_,{button:!0,key:"home",onClick:()=>p("/home")},r.createElement(V,null,r.createElement(ae,null)),r.createElement(Q,{primary:h("Things")})),r.createElement(_,{button:!0,key:"rules",onClick:()=>p("/rules")},r.createElement(V,null,r.createElement(oe,null)),r.createElement(Q,{primary:h("Rules")})),r.createElement(_,{button:!0,key:"settings",onClick:()=>p("/settings")},r.createElement(V,null,r.createElement(ie,null)),r.createElement(Q,{primary:h("Settings")}))),r.createElement(j,null),r.createElement(F,{subheader:r.createElement(W,{component:"div",id:"nested-list-subheader"},"房间列表")},["客厅","餐厅","卧室"].map(((e,t)=>r.createElement(_,{button:!0,key:e},r.createElement(V,null,r.createElement(dt,{type:tt})),r.createElement(Q,{primary:e})))))))}const Rt={en:{translation:{Home:"Home",Things:"Things",Rules:"Rules",Settings:"Settings",Domain:"Domain",Network:"Network",Users:"Users",Addons:"Addons",Localization:"Localization",Updates:"Updates",Authorizations:"Authorizations",Experiments:"Experiments",Developer:"Developer",author:"by",license:"(license)",configure:"configure",update:"update",remove:"remove",disable:"disable",enable:"enable",add:"Add",chooseIcon:"choose icon",version:"version",AddonsMarket:"Add-ons Market",AddNewThings:"Add new things",Open:"Open",Close:"Close",SelectedCapability:"selected capability",Title:"title",fail:"fail",Fail:"Fail",Alarm:"Alarm",AirQualitySensor:"AirQualitySensor",BarometricPressureSensor:"BarometricPressureSensor",BinarySensor:"BinarySensor",Camera:"Camera",ColorControl:"ColorControl",ColorSensor:"ColorSensor",DoorSensor:"DoorSensor",EnergyMonitor:"EnergyMonitor",HumiditySensor:"HumiditySensor",LeakSensor:"LeakSensor",Light:"Light",Lock:"Lock",MotionSensor:"MotionSensor",MultiLevelSensor:"MultiLevelSensor",MultiLevelSwitch:"MultiLevelSwitch",OnOffSwitch:"OnOffSwitch",PushButton:"PushButton",SmartPlug:"SmartPlug",SmokeSensor:"SmokeSensor",TemperatureSensor:"TemperatureSensor",Thermostat:"Thermostat",VideoCamera:"VideoCamera",Custom:"Custom","add things":"add things"}},zh:{translation:{Home:"家庭",Things:"设备",Rules:"规则",Settings:"设置",Domain:"区域",Network:"网络",Users:"用户",Addons:"附加组件","Add-on Configure":"附加组件配置",Localization:"本地化",Updates:"更新",Authorizations:"授权",Experiments:"实验",Developer:"开发者",author:"作者",license:"(许可协议)",configure:"配置",update:"更新",remove:"移除",disable:"禁用",enable:"启用",updating:"正在更新",on:"打开",off:"关闭",add:"添加",chooseIcon:"选择图标",Save:"保存",save:"保存",Saved:"已保存",saved:"已保存",AddNewThings:"添加新设备",Open:"打开",Close:"关闭",SelectedCapability:"选择功能",install:"安装",installed:"已安装",id:"编号",name:"名称",Title:"名称",fail:"失败",failed:"失败",Fail:"失败",version:"版本",AddonsMarket:"插件市场",Alarm:"警报",AirQualitySensor:"空气质量传感器",BarometricPressureSensor:"气压传感器",BinarySensor:"二元传感器",Camera:"摄像头",ColorControl:"ColorControl",ColorSensor:"ColorSensor",DoorSensor:"DoorSensor",EnergyMonitor:"EnergyMonitor",HumiditySensor:"HumiditySensor",LeakSensor:"LeakSensor",Light:"灯",Lock:"锁",MotionSensor:"MotionSensor",MultiLevelSensor:"MultiLevelSensor",MultiLevelSwitch:"MultiLevelSwitch",OnOffSwitch:"开关",PushButton:"PushButton",SmartPlug:"SmartPlug",SmokeSensor:"SmokeSensor",TemperatureSensor:"TemperatureSensor",Thermostat:"Thermostat",VideoCamera:"VideoCamera",Custom:"自定义","add things":"添加配件",disconnect:"失去连接","remove the accessories":"移除配件","accessories removed":"配件已移除",Room:"房间",Ok:"好的"}}};le.use(ce).use(de).init({resources:Rt,lng:"zh",keySeparator:!1,interpolation:{escapeValue:!1}}).catch((e=>{console.log(e)}));const zt=(e="",t="")=>{const n=e.split("."),s=t.split("."),r=Math.max(n.length,s.length);let a=0;for(let o=0;o<r;o++){let e=n.length>o?n[o]:0,t=isNaN(Number(e))?e.charCodeAt():Number(e),r=s.length>o?s[o]:0,i=isNaN(Number(r))?r.charCodeAt():Number(r);if(t<i){a=-1;break}if(t>i){a=1;break}}return a},Dt=t((t=>({root:{},addonCard:{padding:3,display:"flex",maxWidth:400,minWidth:240,margin:5,justifyContent:"space-between",alignItems:"center"},cardContent:{display:"flex",minWidth:200,maxWidth:200,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"},sideContent:{display:"flex",flexDirection:"column",direction:"column",minWidth:80,justifyContent:"flex-start",alignItems:"stretch"},content:{justifyContent:"flex-start",alignItems:"center",direction:"column"},drawerHeader:e(e({display:"flex",alignItems:"center",padding:t.spacing(0,1)},t.mixins.toolbar),{justifyContent:"flex-end"}),appBar:{},title:{marginLeft:t.spacing(2),flex:1}}))),$t=r.forwardRef((function(t,n){return r.createElement(U,e({direction:"up",ref:n},t))})),Bt="loading",Ht="empty",Ft="completed";function Wt(e){const t=Dt(),{t:s,i18n:o}=n(),[c,h]=r.useState(!1),[u,p]=r.useState(!1),[g,f]=r.useState(new Map),[E,w]=r.useState(new Map),[y,v]=r.useState(Bt),[b,C]=r.useState();function k(){return new Promise((function(e,t){rt.getAddonsInfo().then((e=>{if(console.log(e),!(e&&e.urls&&e.architecture&&e.version&&e.nodeVersion))return;const t=new URLSearchParams;t.set("arch",e.architecture),t.set("version",e.version),t.set("node",e.nodeVersion),console.log(e),e.pythonVersions&&e.pythonVersions.length>0&&t.set("python",e.pythonVersions.join(",")),e.testAddons&&t.set("test","1");const n=[];for(const s of e.urls)console.log(s),n.push(fetch(`${s}?${t.toString()}`,{method:"GET",cache:"reload",headers:{Accept:"application/json"}}));return Promise.all(n)})).then((e=>{const t=[];console.log(e,"responses.....");for(const n of e)t.push(n.json());return Promise.all(t)})).then((t=>{let n=new Map;for(const e of t)if(e)for(const t of e){const e={id:t.id,name:t.name,description:t.description,author:t.author,homepage_url:t.homepage_url,license_url:t.license_url,version:t.version,url:t.url,checksum:t.checksum,primary_type:t.primary_type,installed:g.has(t.id)};g.has(t.id)||n.set(t.id,e)}e(n)})).catch((e=>{t(e)}))}))}function T(e){C(e),p(!0)}const x=r.useCallback((()=>{new Promise((function(e,t){rt.getInstalledAddons().then((n=>{if(null===n)return console.log(n),t(new Error("installed empty"));console.log("fetch the installed addon body :",n);let s=new Map;try{for(const e of n)e.isUpdate=!1,s.set(e.id,e)}catch(r){return t(r)}return e(s)}))})).then((e=>(f(e),v(Ft),k()))).catch((e=>(console.log(e),k()))).then((e=>{const t=g;for(const[n,s]of e)null!==t&&t.has(n)&&(s.installed||(e.get(n).installed=!0),zt(s.version,t.get(n).version)>0&&(console.log(zt(s.version,t.get(n).version)),t.get(n).isUpdate=!0,t.get(n).url=s.url));0!==t.size&&f(t),0!==e.size&&w(e)})).catch((e=>{console.log(e)}))}));return r.useEffect((()=>{e.open?(v(Bt),x()):(h(!1),p(!1))}),[e.open]),r.createElement("div",null,r.createElement(A,{fullScreen:!0,open:e.open,onClose:()=>e.show(!1),TransitionComponent:$t},r.createElement(a,{className:t.appBar},r.createElement(i,null,r.createElement(S,null),r.createElement(d,{variant:"h6",className:t.title},s("Addons")),r.createElement(l,{autoFocus:!0,color:"inherit",onClick:()=>e.show(!1),"aria-label":"close"},r.createElement(R,null)),r.createElement(l,{autoFocus:!0,color:"inherit","aria-label":"close",onClick:()=>{h(!0)}},r.createElement(he,null)))),r.createElement(z,{className:t.content,container:!0,justify:"flex-start",alignItems:"center",direction:"column"},r.createElement("div",{className:t.drawerHeader}),y===Bt&&r.createElement(P,{disableShrink:!0}),function(){console.log("installedAddons:",g);const e=[];for(const[t,n]of g){console.log("installedAddons:",t,n);const s=r.createElement(Vt,{key:n.id,id:n.id,name:n.name,short_name:n.short_name,author:n.author,description:n.description,enabled:n.enabled,exec:n.exec,license:n.license_url,version:n.version,primary_type:n.primary_type,schema:n.schema,isUpdate:n.isUpdate,config:T});e.push(s)}return e}(),y===Ht&&r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},r.createElement(m,{cursor:"pointer",onClick:()=>h(!0),style:{fontSize:50}}),r.createElement(d,{variant:"h6",className:t.title},s("Click Added"))))),r.createElement(_t,{installedAddons:g,availableAddons:E,reload:x,open:c,show:h}),r.createElement(qt,{open:u,show:p,addonId:b}))}function _t(e){const t=Dt(),{t:s,i18n:o}=n(),c=e.availableAddons;return r.createElement(A,{fullScreen:!0,className:t.root,open:e.open,onClose:()=>{e.show(!1),e.reload()},TransitionComponent:$t},r.createElement(a,{className:t.appBar},r.createElement(i,null,r.createElement(ue,null),r.createElement(d,{variant:"h6",className:t.title},s("AddonsMarket")),r.createElement(l,{autoFocus:!0,color:"inherit",onClick:()=>{e.show(!1),e.reload()},"aria-label":"close"},r.createElement(R,null)))),r.createElement("div",{className:t.drawerHeader}),r.createElement(z,{className:t.content,container:!0,justify:"flex-start",alignItems:"center",direction:"column"},function(){if(!c)return;const e=[];for(const[t,n]of c)if(c.has(t)){const t=r.createElement(Gt,{key:n.id,id:n.id,name:n.name,author:n.author,description:n.description,homepage_url:n.homepage_url,license_url:n.license_url,url:n.url,version:n.version,primary_type:n.primary_type,checksum:n.checksum,installed:n.installed});e.push(t)}return e}()))}function Vt(t){const s=Dt(),{t:a,i18n:o}=n();return r.createElement(r.Fragment,null,r.createElement(N,{className:s.addonCard,elevation:5},r.createElement(Qt,e({},t)),r.createElement("div",{className:s.sideContent},!t.enabled&&r.createElement(L,{style:{margin:3},variant:"contained",color:"primary"},a("enable")),t.enabled&&r.createElement(L,{style:{margin:3},variant:"contained",color:"primary"},a("disable")),t.isUpdate&&r.createElement(L,{style:{margin:3},variant:"contained",color:"primary"},a("update")),r.createElement(L,{onClick:()=>t.config(t.id),style:{margin:3},variant:"contained",color:"primary"},a("configure")))),r.createElement(j,null))}function Gt(t){const s=Dt(),{t:a,i18n:o}=n(),i="install",l="installed",c="pending",h="failed",[u,m]=r.useState();r.useEffect((()=>{t.installed?m(l):m(i)}),[]);return r.createElement(r.Fragment,null,r.createElement(N,{className:s.addonCard,elevation:10},r.createElement(Qt,e({},t)),r.createElement("div",{className:s.sideContent},u===i&&r.createElement(L,{onClick:()=>{m(c),console.log("install args:",t.id,t.url,t.checksum),rt.installAddon(t.id,t.url,t.checksum).then((e=>{console.log("install addon OK",e),m(l)})).catch((e=>{m(h),console.error(e)}))},variant:"contained",color:"primary"},a("install")),u===l&&r.createElement(L,{variant:"contained",disabled:!0,color:"primary"},a("installed")),u===c&&r.createElement(P,null),u===h&&r.createElement(L,{color:"secondary",disabled:!0,className:s.button},r.createElement(d,{gutterBottom:!0,color:"secondary"},a(h))))),r.createElement(j,null))}function Qt(e){const t=Dt(),{t:s,i18n:a}=n(),o=e;return r.createElement(r.Fragment,null,r.createElement(dt,{style:{fontSize:80},color:"primary",type:o.primary_type}),r.createElement("div",{className:t.cardContent},r.createElement(J,null,s("name"),": "),r.createElement(d,{variant:"h5"},o.name),r.createElement(J,null,s("id"),": "),r.createElement(d,{variant:"subtitle1"},o.id),r.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},r.createElement(J,null,s("version"),": "),r.createElement(d,{variant:"body1"},o.version)),r.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},r.createElement(J,null,s("author"),": "),r.createElement(me,{href:o.homepage_url},o.author)),r.createElement("div",{style:{display:"flex",flexDirection:"row"}},r.createElement(me,{href:o.license_url},s("license")))))}function qt(e){const t=Dt(),{t:s,i18n:o}=n(),[c,h]=r.useState();return r.useEffect((()=>{e.open&&rt.getAddonConfig(e.addonId).then((e=>{h(e),console.log("config------",e)}))}),[e.open]),r.createElement(A,{fullScreen:!0,className:t.root,open:e.open,onClose:()=>{e.show(!1)},TransitionComponent:$t},r.createElement(a,{className:t.appBar},r.createElement(i,null,r.createElement(pe,null),r.createElement(d,{variant:"h6",className:t.title},s("Add-on Configure")),r.createElement(l,{autoFocus:!0,color:"inherit",onClick:()=>{e.show(!1)},"aria-label":"close"},r.createElement(R,null)))),r.createElement("div",{className:t.drawerHeader}),r.createElement(z,{className:t.content,container:!0,justify:"flex-start",alignItems:"center",direction:"column"}))}const Kt=t((t=>({root:{display:"flex"},drawerHeader:e(e({display:"flex",alignItems:"center",padding:t.spacing(0,1)},t.mixins.toolbar),{justifyContent:"flex-end"}),content:{flexGrow:1,padding:t.spacing(3),transition:t.transitions.create("margin",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),marginLeft:200},contentShift:{transition:t.transitions.create("margin",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen}),marginLeft:0},listItem:{maxWidth:400,minWidth:300}})));function Zt(e){const t=Kt(e);s();const{t:a,i18n:i}=n(),{drawerOpen:l,setNewThingsClose:c,setNewThingsOpen:d,newThingsOpen:h}=r.useContext(Xt),[u,m]=r.useState(!1);return r.createElement(r.Fragment,null,r.createElement(ge,null),r.createElement(st,{add:!1,title:a("Settings")}),r.createElement("main",{className:o(t.content,{[t.contentShift]:!l})},r.createElement(z,{container:!0,justify:"flex-start",alignItems:"center",direction:"column"},r.createElement("div",{className:t.drawerHeader}),r.createElement(F,{component:"nav","aria-label":"main mailbox folders",className:t.list},r.createElement(j,null),r.createElement(_,{button:!0,className:t.listItem,variant:"contained",elevation:111},r.createElement(V,null,r.createElement(K,null)),r.createElement(Q,{primary:a("Domain")}),r.createElement(q,null)),r.createElement(j,null),r.createElement(_,{button:!0,className:t.listItem,variant:"contained",onClick:()=>m(!0)},r.createElement(V,null,r.createElement(S,null)),r.createElement(Q,{primary:a("Addons")}),r.createElement(q,null)),r.createElement(j,null),r.createElement(_,{button:!0,className:t.listItem,variant:"contained",elevation:111},r.createElement(V,null,r.createElement(K,null)),r.createElement(Q,{primary:a("Domain")}),r.createElement(q,null)),r.createElement(j,null),r.createElement(_,{button:!0,className:t.listItem,variant:"contained",elevation:111},r.createElement(V,null,r.createElement(K,null)),r.createElement(Q,{primary:a("Domain")}),r.createElement(q,null)),r.createElement(j,null)))),r.createElement(Wt,{open:u,show:m}))}const Xt=r.createContext(),Yt=fe({status:{}});function en(){const[e,t]=r.useState(!1),[n,s]=r.useState(!1);return r.createElement(Ee,{theme:Yt},r.createElement(Xt.Provider,{value:{drawerOpen:e,setDrawerOpen:t,newThingsOpen:n,setNewThingsOpen:s,ts:ct.gatewayModel.things}},r.createElement(we,null,r.createElement(ye,null,r.createElement(ve,{exact:!0,path:"/things"},r.createElement(At,null),r.createElement(jt,{things:ct.gatewayModel.things})),r.createElement(ve,{exact:!0,path:"/settings"},r.createElement(At,null),r.createElement(Zt,null)),r.createElement(ve,{path:"/"},r.createElement(At,null),r.createElement(jt,null))))))}ct.init(),be.render(r.createElement(r.StrictMode,null,r.createElement(en,null)),document.getElementById("root"));
